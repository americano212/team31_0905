<!doctype html>
<html>
  <head>
    <title>SPEEK-SEE-PIC! - Categories</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/css/global.css" />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        background: #fafafa;
        min-height: 100vh;
        position: relative;
        overflow-x: hidden;
      }

      .floating-orb {
        position: fixed;
        border-radius: 50%;
        filter: blur(40px);
        opacity: 0.4;
        pointer-events: none;
        z-index: -1;
        animation: float 20s infinite ease-in-out;
      }

      .orb-1 {
        width: 450px;
        height: 450px;
        background: linear-gradient(135deg, #ffb3a7, #ff8a95);
        top: 10%;
        left: -20%;
        animation-delay: 0s;
      }

      .orb-2 {
        width: 320px;
        height: 320px;
        background: linear-gradient(135deg, #e8d5ff, #c4b5fd);
        bottom: 5%;
        right: -15%;
        animation-delay: -5s;
      }

      .orb-3 {
        width: 200px;
        height: 200px;
        background: linear-gradient(135deg, #b8e0ff, #93c5fd);
        top: 20%;
        right: 15%;
        animation-delay: -10s;
      }

      .orb-4 {
        width: 250px;
        height: 250px;
        background: linear-gradient(135deg, #fbbf24, #f59e0b);
        top: 60%;
        left: 10%;
        animation-delay: -15s;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0px) translateX(0px) rotate(0deg);
        }
        25% {
          transform: translateY(-30px) translateX(20px) rotate(90deg);
        }
        50% {
          transform: translateY(20px) translateX(-25px) rotate(180deg);
        }
        75% {
          transform: translateY(-25px) translateX(15px) rotate(270deg);
        }
      }

      .header {
        background: transparent;
        padding: 25px 0;
        margin-bottom: 40px;
      }

      .header-content {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .logo h1 {
        color: #667eea;
        font-size: 28px;
        font-weight: 800;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .user-info {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .user-name {
        color: #1e293b;
        font-weight: 600;
        background: rgba(255, 255, 255, 0.6);
        backdrop-filter: blur(10px);
        padding: 8px 16px;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.4);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      }

      .logout-btn {
        padding: 10px 20px;
        background: rgba(255, 255, 255, 0.6);
        backdrop-filter: blur(10px);
        color: #4c1d95;
        border: 1px solid rgba(255, 255, 255, 0.4);
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      }

      .logout-btn:hover {
        background: rgba(255, 255, 255, 0.9);
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
      }

      .page-title {
        text-align: center;
        margin-bottom: 40px;
      }

      .page-title h2 {
        font-size: 36px;
        color: #1e293b;
        margin-bottom: 15px;
        font-weight: 800;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .page-title p {
        font-size: 20px;
        color: #475569;
        font-weight: 500;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      }

      .categories-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 24px;
        margin-bottom: 40px;
      }

      .category-card {
        background: rgba(255, 255, 255, 0.6);
        backdrop-filter: blur(15px);
        border-radius: 20px;
        padding: 28px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        cursor: pointer;
        border: 2px solid rgba(255, 255, 255, 0.4);
        position: relative;
        overflow: hidden;
      }

      .category-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent
        );
        transition: left 0.5s ease;
      }

      .category-card:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
        border-color: rgba(102, 126, 234, 0.5);
      }

      .category-card:hover::before {
        left: 100%;
      }

      .category-icon {
        width: 64px;
        height: 64px;
        margin-bottom: 16px;
        display: block;
        object-fit: contain;
        border-radius: 12px;
      }

      .category-name {
        font-size: 24px;
        font-weight: 600;
        color: #1e293b;
        margin-bottom: 8px;
      }

      .category-description {
        color: #64748b;
        font-size: 16px;
        line-height: 1.5;
        margin-bottom: 16px;
      }

      .category-stats {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-top: 16px;
        border-top: 1px solid #e2e8f0;
      }

      .image-count {
        color: #667eea;
        font-weight: 500;
        font-size: 14px;
      }

      .difficulty {
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 500;
      }

      .difficulty.easy {
        background: #dcfce7;
        color: #166534;
      }

      .difficulty.medium {
        background: #fef3c7;
        color: #92400e;
      }

      .difficulty.hard {
        background: #fee2e2;
        color: #991b1b;
      }

      .random-selection {
        text-align: center;
        margin-top: 40px;
      }

      .random-btn {
        padding: 20px 40px;
        background: linear-gradient(
          135deg,
          rgba(102, 126, 234, 0.8),
          rgba(118, 75, 162, 0.8)
        );
        color: white;
        border: none;
        border-radius: 16px;
        font-size: 20px;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        backdrop-filter: blur(15px);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        position: relative;
        overflow: hidden;
      }

      .random-btn::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent
        );
        transition: left 0.5s ease;
      }

      .random-btn:hover {
        transform: translateY(-5px) scale(1.05);
        background: linear-gradient(
          135deg,
          rgba(102, 126, 234, 0.9),
          rgba(118, 75, 162, 0.9)
        );
        box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
      }

      .random-btn:hover::before {
        left: 100%;
      }

      .loading {
        text-align: center;
        padding: 40px;
        color: #64748b;
      }

      @media (max-width: 768px) {
        .categories-grid {
          grid-template-columns: 1fr;
        }

        .header-content {
          flex-direction: column;
          gap: 15px;
        }
      }
    </style>
  </head>
  <body>
    <div class="floating-orb orb-1"></div>
    <div class="floating-orb orb-2"></div>
    <div class="floating-orb orb-3"></div>
    <div class="floating-orb orb-4"></div>
    <div class="header">
      <div class="header-content">
        <div class="logo">
          <h1>SPEEK-SEE-PIC!</h1>
        </div>
        <div class="user-info">
          <span class="user-name" id="user-name">Loading...</span>
          <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
      </div>
    </div>

    <div class="container">
      <div class="page-title">
        <h2>Choose Your Learning Category</h2>
        <p>Select a category to start your English description practice</p>
      </div>

      <div id="categories-container">
        <div class="loading">Loading categories...</div>
      </div>

      <div class="random-selection">
        <button class="random-btn" onclick="selectRandomCategory()">
          üé≤ Surprise Me! (Random Category)
        </button>
      </div>
    </div>

    <script>
      let categories = [];

      // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞Ìôî
      document.addEventListener("DOMContentLoaded", async () => {
        // Î°úÍ∑∏Ïù∏ ÌôïÏù∏
        const user = JSON.parse(localStorage.getItem("user") || "null");
        if (!user) {
          window.location.href = "/login";
          return;
        }

        // ÏÇ¨Ïö©Ïûê Ïù¥Î¶Ñ ÌëúÏãú
        document.getElementById("user-name").textContent =
          `Welcome, ${user.name}!`;

        // Ïπ¥ÌÖåÍ≥†Î¶¨ Î°úÎìú
        await loadCategories();
      });

      async function loadCategories() {
        try {
          const response = await fetch("/api/categories");
          const result = await response.json();

          if (result.success) {
            categories = result.data;
            renderCategories();
          } else {
            throw new Error("Failed to load categories");
          }
        } catch (error) {
          console.error("Error loading categories:", error);
          document.getElementById("categories-container").innerHTML =
            '<div class="loading">Error loading categories. Please refresh the page.</div>';
        }
      }

      function renderCategories() {
        const container = document.getElementById("categories-container");

        // ÎîîÎ≤ÑÍπÖ: Ïπ¥ÌÖåÍ≥†Î¶¨ Îç∞Ïù¥ÌÑ∞ ÌôïÏù∏ (Ï†úÍ±∞ ÏòàÏ†ï)
        // console.log('Categories data:', categories);
        // categories.forEach(cat => console.log('Category ID:', cat.id, 'Name:', cat.name));

        // Ïπ¥ÌÖåÍ≥†Î¶¨ ÏïÑÏù¥ÏΩò Îß§Ìïë (Î∞±ÏóîÎìú IDÏôÄ Ï†ïÌôïÌûà ÏùºÏπò)
        const categoryIcons = {
          animation: "/assets/icon1.png",
          "k-pop": "/assets/icon2.png",
          animal: "/assets/icon3.png",
          AWS: "/assets/icon4.png",
          social: "/assets/icon5.png",
          nature: "/assets/icon1.png",
        };

        // ÎÇúÏù¥ÎèÑ Îß§Ìïë
        const difficultyMap = {
          animation: "easy",
          "k-pop": "medium",
          animal: "easy",
          AWS: "hard",
          social: "medium",
          nature: "easy",
        };

        const categoriesHTML = `
                <div class="categories-grid">
                    ${categories
                      .map(
                        (category) => `
                        <div class="category-card" onclick="selectCategory('${category.id}')">
                            <img class="category-icon" src="${categoryIcons[category.id] || "/assets/12-removebg-preview.png"}" alt="${category.name}" onerror="console.log('Image failed to load:', this.src); this.style.display='none'; this.nextElementSibling.style.display='block';" />
                            <div class="category-icon" style="display:none; font-size:48px; text-align:center; line-height:64px; background:#f1f5f9; color:#64748b; border-radius:12px;">üéØ</div>
                            <div class="category-name">${category.name}</div>
                            <div class="category-description">${category.description}</div>
                            <div class="category-stats">
                                <span class="image-count">${category.imageCount} images available</span>
                                <span class="difficulty ${difficultyMap[category.id] || "medium"}">${difficultyMap[category.id] || "medium"}</span>
                            </div>
                        </div>
                    `
                      )
                      .join("")}
                </div>
            `;

        container.innerHTML = categoriesHTML;
      }

      function selectCategory(categoryId) {
        // ÏÑ†ÌÉùÎêú Ïπ¥ÌÖåÍ≥†Î¶¨ Ï†ÄÏû•
        localStorage.setItem("selectedCategory", categoryId);

        // Ïä§ÌÑ∞Îîî ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô
        window.location.href = `/study?category=${categoryId}`;
      }

      async function selectRandomCategory() {
        if (categories.length === 0) {
          alert("Categories are still loading. Please wait a moment.");
          return;
        }

        // ÎûúÎç§ Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÑ†ÌÉù
        const randomCategory =
          categories[Math.floor(Math.random() * categories.length)];
        selectCategory(randomCategory.id);
      }

      function logout() {
        localStorage.removeItem("user");
        localStorage.removeItem("selectedCategory");
        window.location.href = "/login";
      }
    </script>
  </body>
</html>
